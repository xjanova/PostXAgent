<Page x:Class="AIManager.UI.Views.Pages.SunoOptionsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converters="clr-namespace:AIManager.UI.Converters"
      Title="Suno AI Options">
    <Page.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
    </Page.Resources>
    <ScrollViewer Margin="20">
        <StackPanel>
            <!-- Header -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <materialDesign:PackIcon Kind="Music" Width="32" Height="32" VerticalAlignment="Center"
                                         Foreground="#9C27B0"/>
                <TextBlock Text="Suno AI Options" FontSize="24" FontWeight="Bold" Margin="10,0,0,0"
                           VerticalAlignment="Center"/>
                <Border Background="#E1BEE7" CornerRadius="4" Padding="8,4" Margin="15,0,0,0"
                        VerticalAlignment="Center">
                    <TextBlock Text="Music Generation" FontSize="11" Foreground="#7B1FA2"/>
                </Border>
            </StackPanel>

            <!-- Tab Selector -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <RadioButton x:Name="TabCreate" Content="Create Song" IsChecked="True"
                             Style="{StaticResource MaterialDesignChoiceChipPrimaryOutlineRadioButton}"
                             Checked="Tab_Changed" Margin="0,0,10,0"/>
                <RadioButton x:Name="TabDownload" Content="Download Settings"
                             Style="{StaticResource MaterialDesignChoiceChipPrimaryOutlineRadioButton}"
                             Checked="Tab_Changed" Margin="0,0,10,0"/>
                <RadioButton x:Name="TabWorkflow" Content="Workflow Settings"
                             Style="{StaticResource MaterialDesignChoiceChipPrimaryOutlineRadioButton}"
                             Checked="Tab_Changed" Margin="0,0,10,0"/>
                <RadioButton x:Name="TabAccount" Content="Account"
                             Style="{StaticResource MaterialDesignChoiceChipPrimaryOutlineRadioButton}"
                             Checked="Tab_Changed"/>
            </StackPanel>

            <!-- ==================== CREATE SONG TAB ==================== -->
            <StackPanel x:Name="CreatePanel">
                <!-- Style Selection -->
                <materialDesign:Card Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <materialDesign:PackIcon Kind="MusicNote" Width="24" Height="24"
                                                     VerticalAlignment="Center" Foreground="#9C27B0"/>
                            <TextBlock Text="Music Style" FontSize="18" FontWeight="Bold"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Style Presets -->
                        <TextBlock Text="Quick Presets:" FontWeight="Medium" Margin="0,0,0,10"/>
                        <ItemsControl x:Name="PresetsControl" ItemsSource="{Binding StylePresets}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Margin="0,0,8,8" Padding="12,8"
                                            Click="PresetButton_Click" Tag="{Binding}"
                                            Style="{StaticResource MaterialDesignOutlinedButton}">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="{Binding Icon}" Width="16" Height="16"
                                                                     Margin="0,0,6,0"/>
                                            <TextBlock Text="{Binding Name}"/>
                                        </StackPanel>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Custom Style Input -->
                        <TextBox x:Name="TxtStyle" Text="{Binding DefaultStyle, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Style (e.g., metal ballad, emotional, powerful vocals)"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 Margin="0,15,0,0" TextWrapping="Wrap" AcceptsReturn="False"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Song Title -->
                <materialDesign:Card Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <materialDesign:PackIcon Kind="FormatTitle" Width="24" Height="24"
                                                     VerticalAlignment="Center" Foreground="#9C27B0"/>
                            <TextBlock Text="Song Title" FontSize="18" FontWeight="Bold"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                            <TextBlock Text="(Optional)" FontSize="12" Foreground="#B8B8D0"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <TextBox x:Name="TxtTitle" Text="{Binding SongTitle, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Enter song title"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Lyrics -->
                <materialDesign:Card Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <materialDesign:PackIcon Kind="TextBox" Width="24" Height="24"
                                                     VerticalAlignment="Center" Foreground="#9C27B0"/>
                            <TextBlock Text="Lyrics" FontSize="18" FontWeight="Bold"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Options -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <CheckBox Content="Use Custom Lyrics" IsChecked="{Binding UseCustomLyrics}"
                                      Style="{StaticResource MaterialDesignCheckBox}" Margin="0,0,20,0"/>
                            <CheckBox Content="Instrumental Only (No Vocals)" IsChecked="{Binding InstrumentalOnly}"
                                      Style="{StaticResource MaterialDesignCheckBox}"/>
                        </StackPanel>

                        <!-- Lyrics Templates -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Template:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <ComboBox x:Name="CboTemplates" ItemsSource="{Binding LyricsTemplates}"
                                      SelectedItem="{Binding SelectedTemplate}"
                                      DisplayMemberPath="Name" Width="200"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"/>
                        </StackPanel>

                        <!-- Lyrics TextBox -->
                        <TextBox x:Name="TxtLyrics" Text="{Binding Lyrics, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Enter lyrics here... Use [Verse], [Chorus], [Bridge] tags"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 Height="250" TextWrapping="Wrap" AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 IsEnabled="{Binding UseCustomLyrics}"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Run Button -->
                <Button Content="Create Song with Suno AI" Click="RunWorkflow_Click"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#9C27B0" Foreground="White"
                        Height="45" FontSize="14" Margin="0,10,0,0"
                        IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBooleanConverter}}">
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Play" Width="20" Height="20" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>
            </StackPanel>

            <!-- ==================== DOWNLOAD SETTINGS TAB ==================== -->
            <StackPanel x:Name="DownloadPanel" Visibility="Collapsed">
                <materialDesign:Card Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <materialDesign:PackIcon Kind="FolderDownload" Width="24" Height="24"
                                                     VerticalAlignment="Center" Foreground="#9C27B0"/>
                            <TextBlock Text="Download Location" FontSize="18" FontWeight="Bold"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="TxtFolder" Text="{Binding DownloadFolder}"
                                     materialDesign:HintAssist.Hint="Download Folder"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                            <Button Grid.Column="1" Content="Browse" Click="BrowseFolder_Click"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Margin="10,0,0,0"/>
                        </Grid>

                        <CheckBox Content="Create subfolder for each session"
                                  IsChecked="{Binding CreateSubfolder}"
                                  Style="{StaticResource MaterialDesignCheckBox}" Margin="0,0,0,10"/>

                        <TextBox Text="{Binding FolderNamingPattern, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Folder naming pattern (use {style}, {date}, {title})"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 Margin="0,0,0,10"/>

                        <Border Background="#252540" CornerRadius="8" Padding="12" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="Preview:" FontWeight="Medium" Foreground="#B8B8D0"/>
                                <TextBlock Text="{Binding PreviewFolderName}" FontSize="14" Foreground="#9C27B0"/>
                            </StackPanel>
                        </Border>

                        <CheckBox Content="Include date in folder name"
                                  IsChecked="{Binding IncludeDate}"
                                  Style="{StaticResource MaterialDesignCheckBox}"/>
                    </StackPanel>
                </materialDesign:Card>

                <materialDesign:Card Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <materialDesign:PackIcon Kind="FileMusic" Width="24" Height="24"
                                                     VerticalAlignment="Center" Foreground="#9C27B0"/>
                            <TextBlock Text="File Format" FontSize="18" FontWeight="Bold"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="Download Format:" VerticalAlignment="Center" Margin="0,0,15,0"/>
                            <ComboBox ItemsSource="{Binding AvailableFormats}"
                                      SelectedItem="{Binding DownloadFormat}"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                      Width="120"/>
                        </StackPanel>

                        <TextBox Text="{Binding FileNamingPattern, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="File naming pattern (use {title}, {index})"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                    </StackPanel>
                </materialDesign:Card>

                <materialDesign:Card Padding="20">
                    <StackPanel>
                        <TextBlock Text="Download Options" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

                        <CheckBox Content="Download both songs (Suno creates 2 variations)"
                                  IsChecked="{Binding DownloadBothSongs}"
                                  Style="{StaticResource MaterialDesignCheckBox}" Margin="0,0,0,10"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Wait after download:" VerticalAlignment="Center" Margin="0,0,15,0"/>
                            <TextBox Text="{Binding WaitAfterDownloadMs}" Width="80"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                            <TextBlock Text="ms" VerticalAlignment="Center" Margin="8,0,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>

            <!-- ==================== WORKFLOW SETTINGS TAB ==================== -->
            <StackPanel x:Name="WorkflowPanel" Visibility="Collapsed">
                <materialDesign:Card Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <materialDesign:PackIcon Kind="Cog" Width="24" Height="24"
                                                     VerticalAlignment="Center" Foreground="#9C27B0"/>
                            <TextBlock Text="Timing Settings" FontSize="18" FontWeight="Bold"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,15">
                                <TextBlock Text="Wait for song generation:" Margin="0,0,0,5"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox Text="{Binding WaitForGenerationMs}" Width="100"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="ms (default: 60000)" VerticalAlignment="Center"
                                               Margin="8,0,0,0" Foreground="#B8B8D0"/>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,0,15">
                                <TextBlock Text="Max retries on failure:" Margin="0,0,0,5"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox Text="{Binding MaxRetries}" Width="60"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                                    <TextBlock Text="times" VerticalAlignment="Center"
                                               Margin="8,0,0,0" Foreground="#B8B8D0"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>

                        <CheckBox Content="Auto-retry on failure"
                                  IsChecked="{Binding AutoRetryOnFailure}"
                                  Style="{StaticResource MaterialDesignCheckBox}"/>
                    </StackPanel>
                </materialDesign:Card>

                <materialDesign:Card Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <materialDesign:PackIcon Kind="CodeJson" Width="24" Height="24"
                                                     VerticalAlignment="Center" Foreground="#9C27B0"/>
                            <TextBlock Text="Workflow JSON" FontSize="18" FontWeight="Bold"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <TextBlock TextWrapping="Wrap" Margin="0,0,0,15" Foreground="#B8B8D0">
                            Export current settings as JSON to use with AI automation or API calls.
                        </TextBlock>

                        <Button Content="Copy Workflow JSON" Click="CopyWorkflowJson_Click"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                HorizontalAlignment="Left"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Workflow File Info -->
                <materialDesign:Card Padding="20" Background="#252540">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <materialDesign:PackIcon Kind="FileDocument" Width="20" Height="20"
                                                     Foreground="#4CAF50"/>
                            <TextBlock Text="Workflow File" FontWeight="Bold" Margin="8,0,0,0"/>
                        </StackPanel>
                        <TextBlock Text="suno-create-music.json" Foreground="#9C27B0" FontFamily="Consolas"/>
                        <TextBlock Text="Location: WebAutomation/Workflows/" Foreground="#B8B8D0"
                                   FontSize="11" Margin="0,5,0,0"/>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>

            <!-- ==================== ACCOUNT TAB ==================== -->
            <StackPanel x:Name="AccountPanel" Visibility="Collapsed">
                <materialDesign:Card Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <materialDesign:PackIcon Kind="Account" Width="24" Height="24"
                                                     VerticalAlignment="Center" Foreground="#9C27B0"/>
                            <TextBlock Text="Suno Account" FontSize="18" FontWeight="Bold"
                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <TextBox Text="{Binding SunoEmail}"
                                 materialDesign:HintAssist.Hint="Email"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 Margin="0,0,0,15"/>

                        <PasswordBox x:Name="TxtPassword"
                                     materialDesign:HintAssist.Hint="Password"
                                     Style="{StaticResource MaterialDesignOutlinedPasswordBox}"
                                     Margin="0,0,0,15"/>

                        <CheckBox Content="Remember credentials"
                                  IsChecked="{Binding RememberCredentials}"
                                  Style="{StaticResource MaterialDesignCheckBox}" Margin="0,0,0,15"/>

                        <!-- Connection Status -->
                        <Border x:Name="AccountStatusBorder" Background="#252540" CornerRadius="8" Padding="12">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="10" Height="10" Margin="0,0,10,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="#9E9E9E"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsLoggedIn}" Value="True">
                                                    <Setter Property="Fill" Value="#4CAF50"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                                <TextBlock Foreground="#B8B8D0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Not connected"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsLoggedIn}" Value="True">
                                                    <Setter Property="Text" Value="Connected"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock Text=" | Credits: " Foreground="#B8B8D0"
                                           Visibility="{Binding IsLoggedIn, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                <TextBlock Text="{Binding CreditsRemaining}" Foreground="#9C27B0" FontWeight="Bold"
                                           Visibility="{Binding IsLoggedIn, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            </StackPanel>
                        </Border>

                        <Button Content="Test Connection" Click="TestConnection_Click"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,15,0,0" HorizontalAlignment="Left"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Info -->
                <materialDesign:Card Padding="15" Background="#FFF3E0">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Information" Width="24" Height="24"
                                                 Foreground="#E65100" Margin="0,0,10,0"/>
                        <TextBlock TextWrapping="Wrap" Foreground="#BF360C">
                            Suno AI requires a valid account. Free accounts get 50 credits/month.
                            Visit suno.com to create an account or upgrade your plan.
                        </TextBlock>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>

            <!-- ==================== STATUS BAR ==================== -->
            <Border Background="#252540" CornerRadius="8" Padding="15" Margin="0,20,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Information" Width="16" Height="16"
                                                 Foreground="#B8B8D0" Margin="0,0,8,0"/>
                        <TextBlock x:Name="TxtStatus" Text="{Binding StatusMessage}" Foreground="#B8B8D0"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="Save" Click="SaveSettings_Click"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Background="#9C27B0" Foreground="White"
                                Margin="0,0,10,0" Width="100"/>
                        <Button Content="Reset" Click="ResetSettings_Click"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Width="100"/>
                    </StackPanel>
                </Grid>
            </Border>
        </StackPanel>
    </ScrollViewer>
</Page>
