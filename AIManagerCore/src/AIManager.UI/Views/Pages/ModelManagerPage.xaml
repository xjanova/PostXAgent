<Page x:Class="AIManager.UI.Views.Pages.ModelManagerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converters="clr-namespace:AIManager.UI.Converters"
      xmlns:helpers="clr-namespace:AIManager.UI.Helpers"
      mc:Ignorable="d"
      d:DesignHeight="800" d:DesignWidth="1200"
      Title="Model Manager">

    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>

        <Style x:Key="ModelCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#1E1E2E"/>
            <Setter Property="BorderBrush" Value="#333350"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="16"/>
        </Style>

        <Style x:Key="CategoryHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="0,16,0,12"/>
        </Style>

        <Style x:Key="StatusPillStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="12,4"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
        </Style>

        <Style x:Key="ActiveModelBadge" TargetType="Border">
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#10B981" Offset="0"/>
                        <GradientStop Color="#059669" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="UseModelButton" TargetType="Button">
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="8" Padding="16,8">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#7C4DFF" Offset="0"/>
                                    <GradientStop Color="#6366F1" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Play" Width="16" Height="16" Foreground="White" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                <TextBlock Text="Use Model" FontSize="12" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#7C4DFF" BlurRadius="15" ShadowDepth="0" Opacity="0.5"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid Background="#0D0D14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Padding="24,20">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#1a1a2e" Offset="0"/>
                    <GradientStop Color="#16162a" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <StackPanel Orientation="Horizontal">
                        <Border Width="48" Height="48" CornerRadius="12" Margin="0,0,16,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#7C4DFF" Offset="0"/>
                                    <GradientStop Color="#F472B6" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <materialDesign:PackIcon Kind="Brain" Width="28" Height="28" Foreground="White"
                                                    HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Model Manager" FontSize="28" FontWeight="Bold" Foreground="White"/>
                            <TextBlock Text="HuggingFace Diffusers - Download, Configure &amp; Use AI Models"
                                       FontSize="13" Foreground="#8888AA" Margin="0,4,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Active Model Display -->
                    <Border x:Name="ActiveModelBanner" Background="#202038" CornerRadius="10" Padding="16,10" Margin="0,0,16,0"
                            Visibility="Collapsed">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Width="10" Height="10" Fill="#10B981" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <StackPanel>
                                <TextBlock Text="Active Model" FontSize="10" Foreground="#6B6B8A"/>
                                <TextBlock x:Name="ActiveModelName" Text="-" FontSize="13" FontWeight="SemiBold" Foreground="White"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Storage Info -->
                    <Border Background="#202038" CornerRadius="10" Padding="16,10" Margin="0,0,12,0">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Harddisk" Width="16" Height="16" Foreground="#6B6B8A" Margin="0,0,8,0"/>
                                <TextBlock x:Name="StorageUsedText" Text="0 GB used" Foreground="White" FontWeight="SemiBold" FontSize="13"/>
                            </StackPanel>
                            <ProgressBar x:Name="StorageProgressBar" Value="0" Maximum="100" Height="4"
                                        Margin="0,6,0,0" Width="140">
                                <ProgressBar.Foreground>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#7C4DFF" Offset="0"/>
                                        <GradientStop Color="#F472B6" Offset="1"/>
                                    </LinearGradientBrush>
                                </ProgressBar.Foreground>
                            </ProgressBar>
                        </StackPanel>
                    </Border>

                    <!-- Refresh Button -->
                    <Button x:Name="RefreshButton" Click="RefreshButton_Click" Cursor="Hand"
                            ToolTip="Refresh" Width="44" Height="44">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="#202038" CornerRadius="10">
                                    <materialDesign:PackIcon Kind="Refresh" Width="22" Height="22" Foreground="#9090A8"
                                                            HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#2D2D48"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>

                    <!-- Settings Button -->
                    <Button x:Name="SettingsButton" Click="SettingsButton_Click" Cursor="Hand"
                            ToolTip="API Settings" Width="44" Height="44" Margin="8,0,0,0">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" CornerRadius="10">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#F59E0B" Offset="0"/>
                                            <GradientStop Color="#EF4444" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <materialDesign:PackIcon Kind="Key" Width="22" Height="22" Foreground="White"
                                                            HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Effect">
                                            <Setter.Value>
                                                <DropShadowEffect Color="#F59E0B" BlurRadius="15" ShadowDepth="0" Opacity="0.5"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tab Bar -->
        <Border Grid.Row="1" Background="#15151F" Padding="20,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal">
                    <RadioButton x:Name="TabDownloaded" GroupName="ModelTabs" IsChecked="True" Checked="Tab_Changed" Cursor="Hand">
                        <RadioButton.Template>
                            <ControlTemplate TargetType="RadioButton">
                                <Border x:Name="border" Background="Transparent" CornerRadius="8" Padding="16,10" Margin="0,0,8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Download" Width="18" Height="18" Foreground="#9090A8" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="text" Text="Downloaded" FontSize="13" FontWeight="SemiBold" Foreground="#9090A8" VerticalAlignment="Center"/>
                                        <Border x:Name="countBadge" Background="#7C4DFF" CornerRadius="10" Padding="8,2" Margin="8,0,0,0" Visibility="Collapsed">
                                            <TextBlock x:Name="countText" Text="0" FontSize="11" FontWeight="Bold" Foreground="White"/>
                                        </Border>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#252540"/>
                                        <Setter TargetName="text" Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#1E1E35"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </RadioButton.Template>
                    </RadioButton>

                    <RadioButton x:Name="TabBrowse" GroupName="ModelTabs" Checked="Tab_Changed" Cursor="Hand">
                        <RadioButton.Template>
                            <ControlTemplate TargetType="RadioButton">
                                <Border x:Name="border" Background="Transparent" CornerRadius="8" Padding="16,10" Margin="0,0,8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Magnify" Width="18" Height="18" Foreground="#9090A8" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="text" Text="Browse HuggingFace" FontSize="13" FontWeight="SemiBold" Foreground="#9090A8" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#252540"/>
                                        <Setter TargetName="text" Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#1E1E35"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </RadioButton.Template>
                    </RadioButton>

                    <RadioButton x:Name="TabRecommended" GroupName="ModelTabs" Checked="Tab_Changed" Cursor="Hand">
                        <RadioButton.Template>
                            <ControlTemplate TargetType="RadioButton">
                                <Border x:Name="border" Background="Transparent" CornerRadius="8" Padding="16,10">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Star" Width="18" Height="18" Foreground="#F59E0B" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="text" Text="Recommended" FontSize="13" FontWeight="SemiBold" Foreground="#9090A8" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#252540"/>
                                        <Setter TargetName="text" Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#1E1E35"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </RadioButton.Template>
                    </RadioButton>
                </StackPanel>

                <!-- Quick Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock Text="Need a model?" FontSize="12" Foreground="#6B6B8A" VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <Button Click="GotoBrowse_Click" Cursor="Hand">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="#7C4DFF" CornerRadius="8" Padding="14,8">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Plus" Width="16" Height="16" Foreground="White" Margin="0,0,6,0"/>
                                        <TextBlock Text="Download New" FontSize="12" FontWeight="SemiBold" Foreground="White"/>
                                    </StackPanel>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Effect">
                                            <Setter.Value>
                                                <DropShadowEffect Color="#7C4DFF" BlurRadius="12" ShadowDepth="0" Opacity="0.5"/>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Content Area -->
        <Grid Grid.Row="2">
            <!-- Downloaded Models Tab -->
            <Grid x:Name="DownloadedPanel" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Filter Bar -->
                <Border Grid.Row="0" Background="#12121A" Padding="20,14">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Filter Type -->
                        <Border Background="#1E1E2E" CornerRadius="8" Padding="4">
                            <ComboBox x:Name="FilterTypeCombo" Width="160" SelectionChanged="FilterType_Changed"
                                      Background="Transparent" BorderThickness="0" Foreground="White">
                                <ComboBoxItem Content="All Types" IsSelected="True"/>
                                <ComboBoxItem Content="Text to Image"/>
                                <ComboBoxItem Content="Text to Video"/>
                                <ComboBoxItem Content="LoRA"/>
                                <ComboBoxItem Content="ControlNet"/>
                                <ComboBoxItem Content="VAE"/>
                            </ComboBox>
                        </Border>

                        <!-- Search Box -->
                        <Border Grid.Column="1" Background="#1E1E2E" CornerRadius="8" Margin="16,0" Padding="12,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <materialDesign:PackIcon Kind="Magnify" Width="20" Height="20" Foreground="#6B6B8A" VerticalAlignment="Center"/>
                                <TextBox x:Name="SearchDownloadedBox" Grid.Column="1"
                                         Background="Transparent" BorderThickness="0" Foreground="White"
                                         VerticalAlignment="Center" Margin="10,0,0,0" FontSize="13"
                                         materialDesign:HintAssist.Hint="Search models..."
                                         TextChanged="SearchDownloaded_TextChanged"/>
                            </Grid>
                        </Border>

                        <!-- View Options -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <TextBlock x:Name="ModelCountText" Text="0 models" FontSize="12" Foreground="#6B6B8A" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Downloaded Models Grid -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="12">
                    <ItemsControl x:Name="DownloadedModelsList">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="8" CornerRadius="12" Cursor="Hand">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#1E1E2E" Offset="0"/>
                                            <GradientStop Color="#1A1A28" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="BorderBrush" Value="#2D2D48"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="BorderBrush" Value="#7C4DFF"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Model Info -->
                                        <Grid Margin="20,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Model Thumbnail / Icon -->
                                            <Grid Width="80" Height="80">
                                                <!-- Thumbnail Image with async loading and caching -->
                                                <Border x:Name="ThumbnailContainer" CornerRadius="12" ClipToBounds="True"
                                                        Visibility="{Binding HasThumbnail, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}">
                                                    <Grid>
                                                        <!-- Loading indicator -->
                                                        <Border Background="#20808080" CornerRadius="12">
                                                            <ProgressBar IsIndeterminate="True"
                                                                         Style="{StaticResource MaterialDesignCircularProgressBar}"
                                                                         Width="24" Height="24"
                                                                         Foreground="#7C4DFF"/>
                                                        </Border>
                                                        <!-- Async loaded image -->
                                                        <Image helpers:AsyncImageLoader.SourceUrl="{Binding ThumbnailUrl}"
                                                               Stretch="UniformToFill"
                                                               RenderOptions.BitmapScalingMode="HighQuality"/>
                                                    </Grid>
                                                </Border>

                                                <!-- Fallback Icon (shown when no thumbnail) -->
                                                <Border CornerRadius="12"
                                                        Visibility="{Binding HasThumbnail, Converter={StaticResource InverseBooleanToVisibilityConverter}, FallbackValue=Visible}">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                            <GradientStop Color="#30808080" Offset="0"/>
                                                            <GradientStop Color="#15808080" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                    <materialDesign:PackIcon Kind="{Binding TypeIcon}"
                                                                            Width="36" Height="36"
                                                                            HorizontalAlignment="Center"
                                                                            VerticalAlignment="Center"
                                                                            Foreground="{Binding TypeColor}"/>
                                                </Border>
                                            </Grid>

                                            <!-- Model Details -->
                                            <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Name}" FontSize="15" FontWeight="SemiBold" Foreground="White"
                                                               TextTrimming="CharacterEllipsis" MaxWidth="250"/>
                                                    <Border x:Name="ActiveBadge" Visibility="{Binding IsActive, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}"
                                                            Background="#10B981" CornerRadius="4" Padding="6,2" Margin="8,0,0,0">
                                                        <TextBlock Text="ACTIVE" FontSize="9" FontWeight="Bold" Foreground="White"/>
                                                    </Border>
                                                </StackPanel>
                                                <TextBlock Text="{Binding ModelId}" FontSize="11" Foreground="#6B6B8A"
                                                           Margin="0,4,0,0" TextTrimming="CharacterEllipsis" MaxWidth="280"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                    <Border CornerRadius="6" Padding="8,3">
                                                        <Border.Background>
                                                            <SolidColorBrush Color="{Binding TypeColor}" Opacity="0.2"/>
                                                        </Border.Background>
                                                        <TextBlock Text="{Binding TypeName}" FontSize="10" FontWeight="SemiBold"
                                                                   Foreground="{Binding TypeColor}"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding SizeFormatted}" FontSize="11" Foreground="#6B6B8A"
                                                               Margin="12,0,0,0" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>

                                        <!-- Action Bar -->
                                        <Border Grid.Row="1" Background="#15151F" CornerRadius="0,0,12,12" Padding="16,12">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Use Model Button -->
                                                <Button Style="{StaticResource UseModelButton}"
                                                        Tag="{Binding ModelId}"
                                                        Click="UseModel_Click"/>

                                                <!-- Delete Button -->
                                                <Button Grid.Column="1" Tag="{Binding ModelId}" Click="DeleteModel_Click"
                                                        ToolTip="Delete Model" Cursor="Hand">
                                                    <Button.Template>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border x:Name="border" Background="#251A1A" CornerRadius="8" Padding="10,8">
                                                                <materialDesign:PackIcon Kind="Delete" Width="18" Height="18" Foreground="#EF4444"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="border" Property="Background" Value="#3D2020"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Button.Template>
                                                </Button>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Empty State -->
                <Border x:Name="EmptyDownloadedState" Visibility="Collapsed" Grid.Row="1"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
                    <StackPanel HorizontalAlignment="Center">
                        <Border Width="100" Height="100" CornerRadius="50" Background="#1E1E2E" HorizontalAlignment="Center">
                            <materialDesign:PackIcon Kind="CloudDownloadOutline" Width="48" Height="48"
                                                    Foreground="#4B4B6A" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="No Models Downloaded" FontSize="20" FontWeight="SemiBold" Foreground="White"
                                   Margin="0,24,0,0" HorizontalAlignment="Center"/>
                        <TextBlock Text="Download models from HuggingFace to start generating images" FontSize="13" Foreground="#6B6B8A"
                                   Margin="0,8,0,0" HorizontalAlignment="Center"/>
                        <Button Margin="0,24,0,0" Click="GotoBrowse_Click" Cursor="Hand" HorizontalAlignment="Center">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border CornerRadius="10" Padding="24,14">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="#7C4DFF" Offset="0"/>
                                                <GradientStop Color="#6366F1" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Download" Width="20" Height="20" Foreground="White" Margin="0,0,10,0"/>
                                            <TextBlock Text="Browse Models" FontSize="14" FontWeight="SemiBold" Foreground="White"/>
                                        </StackPanel>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Browse Models Tab -->
            <Grid x:Name="BrowsePanel" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Search Bar -->
                <Border Grid.Row="0" Background="#12121A" Padding="20,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Search Input -->
                        <Border Background="#1E1E2E" CornerRadius="10" Padding="16,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <materialDesign:PackIcon Kind="Magnify" Width="22" Height="22" Foreground="#6B6B8A" VerticalAlignment="Center"/>
                                <TextBox x:Name="SearchHuggingFaceBox" Grid.Column="1"
                                         Background="Transparent" BorderThickness="0" Foreground="White"
                                         VerticalAlignment="Center" Margin="12,0,0,0" FontSize="14"
                                         materialDesign:HintAssist.Hint="Search HuggingFace models (e.g., stable-diffusion, flux, sdxl)"
                                         KeyDown="SearchHuggingFace_KeyDown"/>
                            </Grid>
                        </Border>

                        <Button Grid.Column="1" Margin="16,0,0,0" Click="SearchHuggingFace_Click" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" CornerRadius="10" Padding="24,14">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="#7C4DFF" Offset="0"/>
                                                <GradientStop Color="#6366F1" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Magnify" Width="18" Height="18" Foreground="White" Margin="0,0,8,0"/>
                                            <TextBlock Text="Search" FontSize="14" FontWeight="SemiBold" Foreground="White"/>
                                        </StackPanel>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Effect">
                                                <Setter.Value>
                                                    <DropShadowEffect Color="#7C4DFF" BlurRadius="15" ShadowDepth="0" Opacity="0.5"/>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </Border>

                <!-- Search Results -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="12">
                    <ItemsControl x:Name="SearchResultsList">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="8" CornerRadius="12" Background="#1E1E2E" BorderBrush="#2D2D48" BorderThickness="1">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Thumbnail (when available) with async loading -->
                                        <Border Grid.Row="0" Height="120" CornerRadius="12,12,0,0" ClipToBounds="True"
                                                Visibility="{Binding HasThumbnail, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}">
                                            <Grid>
                                                <!-- Loading indicator -->
                                                <Border Background="#20808080">
                                                    <ProgressBar IsIndeterminate="True"
                                                                 Style="{StaticResource MaterialDesignCircularProgressBar}"
                                                                 Width="28" Height="28"
                                                                 Foreground="#7C4DFF"/>
                                                </Border>
                                                <!-- Async loaded image -->
                                                <Image helpers:AsyncImageLoader.SourceUrl="{Binding ThumbnailUrl}"
                                                       Stretch="UniformToFill"
                                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                                            </Grid>
                                        </Border>

                                        <!-- Model Info -->
                                        <StackPanel Grid.Row="1" Margin="20,16">
                                            <TextBlock Text="{Binding ModelId}" FontSize="15" FontWeight="SemiBold"
                                                       Foreground="White" TextWrapping="Wrap"/>
                                            <TextBlock Text="{Binding Description}" FontSize="12" Foreground="#6B6B8A"
                                                       Margin="0,8,0,0" TextWrapping="Wrap" MaxHeight="40"/>

                                            <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                                <Border Background="#202038" CornerRadius="6" Padding="8,4" Margin="0,0,8,0">
                                                    <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon Kind="Download" Width="14" Height="14" Foreground="#10B981"/>
                                                        <TextBlock Text="{Binding DownloadsFormatted}" FontSize="11" Foreground="#10B981" Margin="4,0,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                                <Border Background="#202038" CornerRadius="6" Padding="8,4">
                                                    <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon Kind="Heart" Width="14" Height="14" Foreground="#F472B6"/>
                                                        <TextBlock Text="{Binding LikesFormatted}" FontSize="11" Foreground="#F472B6" Margin="4,0,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Download Button -->
                                        <Border Grid.Row="2" Background="#15151F" CornerRadius="0,0,12,12" Padding="16,12">
                                            <Button Tag="{Binding ModelId}" Click="DownloadModel_Click" Cursor="Hand" HorizontalAlignment="Stretch">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border x:Name="border" CornerRadius="8" Padding="0,10">
                                                            <Border.Background>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                    <GradientStop Color="#10B981" Offset="0"/>
                                                                    <GradientStop Color="#059669" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Border.Background>
                                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                                <materialDesign:PackIcon Kind="Download" Width="18" Height="18" Foreground="White"/>
                                                                <TextBlock Text="Download" FontSize="13" FontWeight="SemiBold" Foreground="White" Margin="8,0,0,0"/>
                                                            </StackPanel>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="border" Property="Effect">
                                                                    <Setter.Value>
                                                                        <DropShadowEffect Color="#10B981" BlurRadius="12" ShadowDepth="0" Opacity="0.5"/>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Loading State -->
                <Border x:Name="SearchLoadingState" Visibility="Collapsed" Grid.Row="1"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
                    <StackPanel HorizontalAlignment="Center">
                        <ProgressBar IsIndeterminate="True" Width="60" Height="60"
                                    Style="{StaticResource MaterialDesignCircularProgressBar}"
                                    Foreground="#7C4DFF"/>
                        <TextBlock Text="Searching HuggingFace..." FontSize="14" Foreground="#6B6B8A"
                                   Margin="0,20,0,0" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Recommended Models Tab -->
            <ScrollViewer x:Name="RecommendedPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <!-- Text to Image Section -->
                    <Border Background="#15151F" CornerRadius="12" Padding="20" Margin="0,0,0,16">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <Border Width="40" Height="40" CornerRadius="10" Background="#307C4DFF">
                                    <materialDesign:PackIcon Kind="Image" Width="22" Height="22" Foreground="#7C4DFF"
                                                            HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="Text to Image" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                    <TextBlock Text="Generate images from text prompts" FontSize="12" Foreground="#6B6B8A"/>
                                </StackPanel>
                            </StackPanel>
                            <WrapPanel x:Name="TextToImageList"/>
                        </StackPanel>
                    </Border>

                    <!-- Text to Video Section -->
                    <Border Background="#15151F" CornerRadius="12" Padding="20" Margin="0,0,0,16">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <Border Width="40" Height="40" CornerRadius="10" Background="#3006B6D4">
                                    <materialDesign:PackIcon Kind="Video" Width="22" Height="22" Foreground="#06B6D4"
                                                            HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="Text to Video" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                    <TextBlock Text="Generate videos from text prompts" FontSize="12" Foreground="#6B6B8A"/>
                                </StackPanel>
                            </StackPanel>
                            <WrapPanel x:Name="TextToVideoList"/>
                        </StackPanel>
                    </Border>

                    <!-- LoRA Section -->
                    <Border Background="#15151F" CornerRadius="12" Padding="20" Margin="0,0,0,16">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <Border Width="40" Height="40" CornerRadius="10" Background="#30F59E0B">
                                    <materialDesign:PackIcon Kind="LayersTriple" Width="22" Height="22" Foreground="#F59E0B"
                                                            HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="LoRA" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                    <TextBlock Text="Fine-tuned style adapters" FontSize="12" Foreground="#6B6B8A"/>
                                </StackPanel>
                            </StackPanel>
                            <WrapPanel x:Name="LoraList"/>
                        </StackPanel>
                    </Border>

                    <!-- ControlNet Section -->
                    <Border Background="#15151F" CornerRadius="12" Padding="20">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <Border Width="40" Height="40" CornerRadius="10" Background="#3010B981">
                                    <materialDesign:PackIcon Kind="DrawingBox" Width="22" Height="22" Foreground="#10B981"
                                                            HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="ControlNet" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                    <TextBlock Text="Precise image control models" FontSize="12" Foreground="#6B6B8A"/>
                                </StackPanel>
                            </StackPanel>
                            <WrapPanel x:Name="ControlNetList"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- Download Progress Overlay -->
            <Border x:Name="DownloadProgressOverlay" Visibility="Collapsed" Background="#E0000000">
                <Border Background="#1E1E2E" CornerRadius="16" Padding="32"
                        HorizontalAlignment="Center" VerticalAlignment="Center"
                        MinWidth="450" BorderBrush="#333350" BorderThickness="1">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <Border Width="48" Height="48" CornerRadius="12">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#7C4DFF" Offset="0"/>
                                        <GradientStop Color="#6366F1" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <materialDesign:PackIcon Kind="Download" Width="24" Height="24" Foreground="White"
                                                        HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel Margin="16,0,0,0" VerticalAlignment="Center">
                                <TextBlock Text="Downloading Model" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                                <TextBlock x:Name="DownloadModelName" Text="" FontSize="12" Foreground="#6B6B8A" Margin="0,4,0,0"/>
                            </StackPanel>
                        </StackPanel>

                        <ProgressBar x:Name="DownloadProgressBar" Value="0" Maximum="100" Height="8" Margin="0,0,0,0">
                            <ProgressBar.Foreground>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#7C4DFF" Offset="0"/>
                                    <GradientStop Color="#10B981" Offset="1"/>
                                </LinearGradientBrush>
                            </ProgressBar.Foreground>
                        </ProgressBar>

                        <Grid Margin="0,12,0,0">
                            <TextBlock x:Name="DownloadProgressText" Text="0%" FontSize="13" Foreground="White" FontWeight="SemiBold"/>
                            <TextBlock x:Name="DownloadSpeedText" Text="" FontSize="12" Foreground="#6B6B8A" HorizontalAlignment="Right"/>
                        </Grid>

                        <Button x:Name="CancelDownloadButton" Margin="0,24,0,0" Click="CancelDownload_Click" Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border" Background="#251A1A" CornerRadius="8" Padding="0,12">
                                        <TextBlock Text="Cancel Download" FontSize="13" Foreground="#EF4444" HorizontalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#3D2020"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Border>
            </Border>
        </Grid>
    </Grid>
</Page>
