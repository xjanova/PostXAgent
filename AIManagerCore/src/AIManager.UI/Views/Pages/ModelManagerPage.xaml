<Page x:Class="AIManager.UI.Views.Pages.ModelManagerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      mc:Ignorable="d"
      d:DesignHeight="800" d:DesignWidth="1200"
      Title="Model Manager">

    <Page.Resources>
        <Style x:Key="ModelCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="BorderBrush" Value="#333"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="16"/>
        </Style>

        <Style x:Key="CategoryHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="0,16,0,12"/>
        </Style>

        <Style x:Key="StatusPillStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="12,4"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
        </Style>
    </Page.Resources>

    <Grid Background="#121212">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#1a1a2e" Padding="24,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Model Manager" FontSize="28" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="จัดการ Models จาก HuggingFace - ดาวน์โหลด ตั้งค่า และใช้งาน"
                               FontSize="14" Foreground="#888" Margin="0,4,0,0"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Storage Info -->
                    <Border Background="#2d2d44" CornerRadius="8" Padding="12,8" Margin="0,0,16,0">
                        <StackPanel>
                            <TextBlock x:Name="StorageUsedText" Text="0 GB used" Foreground="White" FontWeight="SemiBold"/>
                            <ProgressBar x:Name="StorageProgressBar" Value="0" Maximum="100" Height="4"
                                        Margin="0,4,0,0" Width="120" Foreground="#7C4DFF"/>
                        </StackPanel>
                    </Border>

                    <Button x:Name="RefreshButton" Click="RefreshButton_Click"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Foreground="White" ToolTip="รีเฟรช">
                        <materialDesign:PackIcon Kind="Refresh" Width="24" Height="24"/>
                    </Button>

                    <Button x:Name="SettingsButton" Click="SettingsButton_Click"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Foreground="White" ToolTip="ตั้งค่า" Margin="8,0,0,0">
                        <materialDesign:PackIcon Kind="Cog" Width="24" Height="24"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tab Bar -->
        <Border Grid.Row="1" Background="#1E1E1E" Padding="16,8">
            <StackPanel Orientation="Horizontal">
                <RadioButton x:Name="TabDownloaded" Content="ดาวน์โหลดแล้ว" GroupName="ModelTabs"
                            IsChecked="True" Checked="Tab_Changed"
                            Style="{StaticResource MaterialDesignTabRadioButton}"
                            Foreground="White" Margin="0,0,8,0"/>
                <RadioButton x:Name="TabBrowse" Content="ค้นหาโมเดล" GroupName="ModelTabs"
                            Checked="Tab_Changed"
                            Style="{StaticResource MaterialDesignTabRadioButton}"
                            Foreground="White" Margin="0,0,8,0"/>
                <RadioButton x:Name="TabRecommended" Content="แนะนำ" GroupName="ModelTabs"
                            Checked="Tab_Changed"
                            Style="{StaticResource MaterialDesignTabRadioButton}"
                            Foreground="White"/>
            </StackPanel>
        </Border>

        <!-- Content Area -->
        <Grid Grid.Row="2">
            <!-- Downloaded Models Tab -->
            <Grid x:Name="DownloadedPanel" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Filter Bar -->
                <Border Grid.Row="0" Background="#1E1E1E" Padding="16,12">
                    <StackPanel Orientation="Horizontal">
                        <ComboBox x:Name="FilterTypeCombo" Width="150" SelectionChanged="FilterType_Changed"
                                  materialDesign:HintAssist.Hint="ประเภท"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}">
                            <ComboBoxItem Content="ทั้งหมด" IsSelected="True"/>
                            <ComboBoxItem Content="Text to Image"/>
                            <ComboBoxItem Content="Text to Video"/>
                            <ComboBoxItem Content="LoRA"/>
                            <ComboBoxItem Content="ControlNet"/>
                            <ComboBoxItem Content="VAE"/>
                        </ComboBox>

                        <TextBox x:Name="SearchDownloadedBox" Width="300" Margin="16,0,0,0"
                                 materialDesign:HintAssist.Hint="ค้นหาโมเดล..."
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 TextChanged="SearchDownloaded_TextChanged"/>
                    </StackPanel>
                </Border>

                <!-- Downloaded Models List -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="DownloadedModelsList" Margin="8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource ModelCardStyle}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="80"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Model Icon -->
                                        <Border Grid.Column="0" Width="64" Height="64" CornerRadius="8"
                                                Background="#2d2d44">
                                            <materialDesign:PackIcon Kind="{Binding TypeIcon}"
                                                                    Width="32" Height="32"
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"
                                                                    Foreground="#7C4DFF"/>
                                        </Border>

                                        <!-- Model Info -->
                                        <StackPanel Grid.Column="1" Margin="16,0">
                                            <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="SemiBold"
                                                       Foreground="White"/>
                                            <TextBlock Text="{Binding ModelId}" FontSize="12" Foreground="#888"
                                                       Margin="0,2,0,0"/>

                                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                <Border Style="{StaticResource StatusPillStyle}"
                                                        Background="{Binding TypeColor}">
                                                    <TextBlock Text="{Binding TypeName}" FontSize="11"
                                                               Foreground="White"/>
                                                </Border>

                                                <TextBlock Text="{Binding SizeFormatted}" FontSize="12"
                                                           Foreground="#888" Margin="12,0,0,0"
                                                           VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Actions -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                            <Button Content="ใช้งาน"
                                                    Style="{StaticResource MaterialDesignFlatButton}"
                                                    Foreground="#7C4DFF"
                                                    Tag="{Binding ModelId}"
                                                    Click="UseModel_Click"/>
                                            <Button Style="{StaticResource MaterialDesignFlatButton}"
                                                    Foreground="#FF5252"
                                                    Tag="{Binding ModelId}"
                                                    Click="DeleteModel_Click"
                                                    ToolTip="ลบโมเดล">
                                                <materialDesign:PackIcon Kind="Delete"/>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Empty State -->
                <StackPanel x:Name="EmptyDownloadedState" Visibility="Collapsed"
                            HorizontalAlignment="Center" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="CloudDownloadOutline" Width="64" Height="64"
                                            Foreground="#555" HorizontalAlignment="Center"/>
                    <TextBlock Text="ยังไม่มีโมเดลที่ดาวน์โหลด" FontSize="16" Foreground="#888"
                               Margin="0,16,0,0" HorizontalAlignment="Center"/>
                    <Button Content="ค้นหาโมเดล" Margin="0,16,0,0"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#7C4DFF"
                            Click="GotoBrowse_Click"/>
                </StackPanel>
            </Grid>

            <!-- Browse Models Tab -->
            <Grid x:Name="BrowsePanel" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Search Bar -->
                <Border Grid.Row="0" Background="#1E1E1E" Padding="16,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="SearchHuggingFaceBox" Grid.Column="0"
                                 materialDesign:HintAssist.Hint="ค้นหาโมเดลจาก HuggingFace..."
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 KeyDown="SearchHuggingFace_KeyDown"/>

                        <Button x:Name="SearchButton" Grid.Column="1" Content="ค้นหา" Margin="16,0,0,0"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Background="#7C4DFF"
                                Click="SearchHuggingFace_Click"/>
                    </Grid>
                </Border>

                <!-- Search Results -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="SearchResultsList" Margin="8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource ModelCardStyle}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Model Info -->
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding ModelId}" FontSize="16" FontWeight="SemiBold"
                                                       Foreground="White"/>
                                            <TextBlock Text="{Binding Description}" FontSize="12" Foreground="#888"
                                                       Margin="0,4,0,0" TextWrapping="Wrap" MaxWidth="600"/>

                                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                <materialDesign:PackIcon Kind="Download" Foreground="#888"
                                                                        VerticalAlignment="Center"/>
                                                <TextBlock Text="{Binding DownloadsFormatted}" FontSize="12"
                                                           Foreground="#888" Margin="4,0,16,0"/>

                                                <materialDesign:PackIcon Kind="Heart" Foreground="#888"
                                                                        VerticalAlignment="Center"/>
                                                <TextBlock Text="{Binding LikesFormatted}" FontSize="12"
                                                           Foreground="#888" Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Download Button -->
                                        <Button Grid.Column="1" Content="ดาวน์โหลด"
                                                Style="{StaticResource MaterialDesignRaisedButton}"
                                                Background="#7C4DFF"
                                                Tag="{Binding ModelId}"
                                                Click="DownloadModel_Click"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Loading State -->
                <StackPanel x:Name="SearchLoadingState" Visibility="Collapsed"
                            HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" Width="100" Style="{StaticResource MaterialDesignCircularProgressBar}"/>
                    <TextBlock Text="กำลังค้นหา..." FontSize="14" Foreground="#888"
                               Margin="0,16,0,0" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>

            <!-- Recommended Models Tab -->
            <ScrollViewer x:Name="RecommendedPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="16">
                    <!-- Text to Image -->
                    <TextBlock Text="Text to Image" Style="{StaticResource CategoryHeaderStyle}"/>
                    <TextBlock Text="โมเดลสำหรับสร้างภาพจากข้อความ" FontSize="12" Foreground="#888" Margin="0,0,0,12"/>

                    <WrapPanel x:Name="TextToImageList">
                        <!-- Items will be added programmatically -->
                    </WrapPanel>

                    <!-- Text to Video -->
                    <TextBlock Text="Text to Video" Style="{StaticResource CategoryHeaderStyle}"/>
                    <TextBlock Text="โมเดลสำหรับสร้างวิดีโอจากข้อความ" FontSize="12" Foreground="#888" Margin="0,0,0,12"/>

                    <WrapPanel x:Name="TextToVideoList">
                        <!-- Items will be added programmatically -->
                    </WrapPanel>

                    <!-- LoRA -->
                    <TextBlock Text="LoRA" Style="{StaticResource CategoryHeaderStyle}"/>
                    <TextBlock Text="โมเดลเสริมสำหรับปรับแต่ง style" FontSize="12" Foreground="#888" Margin="0,0,0,12"/>

                    <WrapPanel x:Name="LoraList">
                        <!-- Items will be added programmatically -->
                    </WrapPanel>

                    <!-- ControlNet -->
                    <TextBlock Text="ControlNet" Style="{StaticResource CategoryHeaderStyle}"/>
                    <TextBlock Text="โมเดลสำหรับควบคุมการสร้างภาพ" FontSize="12" Foreground="#888" Margin="0,0,0,12"/>

                    <WrapPanel x:Name="ControlNetList">
                        <!-- Items will be added programmatically -->
                    </WrapPanel>
                </StackPanel>
            </ScrollViewer>

            <!-- Download Progress Overlay -->
            <Border x:Name="DownloadProgressOverlay" Visibility="Collapsed"
                    Background="#CC000000">
                <Border Background="#2d2d44" CornerRadius="12" Padding="32"
                        HorizontalAlignment="Center" VerticalAlignment="Center"
                        MinWidth="400">
                    <StackPanel>
                        <TextBlock x:Name="DownloadModelName" Text="Downloading model..."
                                   FontSize="16" FontWeight="SemiBold" Foreground="White"/>

                        <ProgressBar x:Name="DownloadProgressBar" Value="0" Maximum="100"
                                    Height="8" Margin="0,16,0,0"
                                    Foreground="#7C4DFF"/>

                        <Grid Margin="0,8,0,0">
                            <TextBlock x:Name="DownloadProgressText" Text="0%" Foreground="#888"/>
                            <TextBlock x:Name="DownloadSpeedText" Text="" Foreground="#888"
                                       HorizontalAlignment="Right"/>
                        </Grid>

                        <Button x:Name="CancelDownloadButton" Content="ยกเลิก" Margin="0,16,0,0"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                BorderBrush="#FF5252" Foreground="#FF5252"
                                Click="CancelDownload_Click"/>
                    </StackPanel>
                </Border>
            </Border>
        </Grid>
    </Grid>
</Page>
