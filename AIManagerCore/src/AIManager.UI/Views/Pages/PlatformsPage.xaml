<Page x:Class="AIManager.UI.Views.Pages.PlatformsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="Platforms">
    <ScrollViewer Margin="20">
        <StackPanel>
            <TextBlock Text="Social Media Platforms" FontSize="24" FontWeight="Bold" Foreground="White" Margin="0,0,0,10"/>
            <TextBlock Text="เชื่อมต่อและจัดการ Social Media Accounts" Foreground="#B8B8D0" Margin="0,0,0,20"/>

            <!-- Tab Selector -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <RadioButton x:Name="TabPlatforms" Content="Platforms" IsChecked="True"
                             Style="{StaticResource MaterialDesignChoiceChipPrimaryOutlineRadioButton}"
                             Checked="Tab_Changed" Margin="0,0,10,0"/>
                <RadioButton x:Name="TabAccountPools" Content="Account Pools"
                             Style="{StaticResource MaterialDesignChoiceChipPrimaryOutlineRadioButton}"
                             Checked="Tab_Changed" Margin="0,0,10,0"/>
                <RadioButton x:Name="TabHealthMonitor" Content="Health Monitor"
                             Style="{StaticResource MaterialDesignChoiceChipPrimaryOutlineRadioButton}"
                             Checked="Tab_Changed"/>
            </StackPanel>

            <!-- Platforms Panel -->
            <StackPanel x:Name="PlatformsPanel">
                <ItemsControl x:Name="PlatformsList">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <materialDesign:Card Width="280" Height="220" Margin="10" Padding="15">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Header -->
                                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                        <Border Background="{Binding Color}" CornerRadius="8" Padding="8">
                                            <materialDesign:PackIcon Kind="{Binding Icon}" Width="24" Height="24" Foreground="White"/>
                                        </Border>
                                        <StackPanel Margin="10,0,0,0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                            <TextBlock Text="{Binding AuthType}" FontSize="10" Foreground="#B8B8D0"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Setup Info -->
                                    <StackPanel Grid.Row="1">
                                        <TextBlock Text="{Binding RequiredCredentialsText}" FontSize="11" TextWrapping="Wrap" Foreground="#B8B8D0"/>
                                    </StackPanel>

                                    <!-- Status -->
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,10">
                                        <Ellipse Width="10" Height="10" Margin="0,0,8,0">
                                            <Ellipse.Style>
                                                <Style TargetType="Ellipse">
                                                    <Setter Property="Fill" Value="#9E9E9E"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="Connected">
                                                            <Setter Property="Fill" Value="#4CAF50"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Configured">
                                                            <Setter Property="Fill" Value="#2196F3"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Error">
                                                            <Setter Property="Fill" Value="#F44336"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Ellipse.Style>
                                        </Ellipse>
                                        <TextBlock Text="{Binding StatusText}" FontSize="12" Foreground="White"/>
                                        <TextBlock Text="{Binding AccountCount}" FontSize="12" Foreground="#B8B8D0" Margin="10,0,0,0"/>
                                    </StackPanel>

                                    <!-- Actions -->
                                    <StackPanel Grid.Row="3" Orientation="Horizontal">
                                        <Button Content="Setup" Click="SetupPlatform_Click" Tag="{Binding Platform}"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Margin="0,0,8,0" Height="28" Padding="12,0"/>
                                        <Button Content="Accounts" Click="ManageAccounts_Click" Tag="{Binding Platform}"
                                                Style="{StaticResource MaterialDesignFlatButton}"
                                                Height="28" Padding="12,0"/>
                                        <Button Click="OpenDocs_Click" Tag="{Binding DocsUrl}"
                                                Style="{StaticResource MaterialDesignIconButton}"
                                                Height="28" Width="28" Padding="0" ToolTip="Documentation">
                                            <materialDesign:PackIcon Kind="HelpCircleOutline" Width="18" Height="18"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </materialDesign:Card>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

            <!-- Account Pools Panel -->
            <StackPanel x:Name="AccountPoolsPanel" Visibility="Collapsed">
                <!-- Action Bar -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                    <Button Content="Create Pool" Click="CreatePool_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"/>
                    <ComboBox x:Name="CmbPoolPlatformFilter" Width="150" Margin="15,0,0,0"
                              materialDesign:HintAssist.Hint="Filter by Platform"
                              SelectionChanged="PoolFilter_Changed"/>
                </StackPanel>

                <!-- Pools List -->
                <ItemsControl x:Name="PoolsList">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <materialDesign:Card Margin="0,0,0,15" Padding="15">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="Bold"/>
                                            <Border Background="{Binding PlatformColor}" CornerRadius="4"
                                                    Padding="6,2" Margin="10,0,0,0">
                                                <TextBlock Text="{Binding PlatformName}" FontSize="10" Foreground="White"/>
                                            </Border>
                                            <Border CornerRadius="4" Padding="6,2" Margin="5,0,0,0">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="#E8F5E9"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                                                                <Setter Property="Background" Value="#FFEBEE"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock FontSize="10">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="Active"/>
                                                            <Setter Property="Foreground" Value="#2E7D32"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                                                                    <Setter Property="Text" Value="Disabled"/>
                                                                    <Setter Property="Foreground" Value="#C62828"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>
                                        </StackPanel>

                                        <TextBlock Text="{Binding Description}" Foreground="#B8B8D0" Margin="0,5,0,0"/>

                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                            <TextBlock FontSize="12">
                                                <Run Text="Accounts: " Foreground="#B8B8D0"/>
                                                <Run Text="{Binding AccountCount}" FontWeight="Bold"/>
                                            </TextBlock>
                                            <TextBlock FontSize="12" Margin="15,0,0,0">
                                                <Run Text="Available: " Foreground="#B8B8D0"/>
                                                <Run Text="{Binding AvailableCount}" FontWeight="Bold" Foreground="#4CAF50"/>
                                            </TextBlock>
                                            <TextBlock FontSize="12" Margin="15,0,0,0">
                                                <Run Text="Posts Today: " Foreground="#B8B8D0"/>
                                                <Run Text="{Binding PostsToday}" FontWeight="Bold"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                        <Button Content="Manage" Click="ManagePoolAccounts_Click" Tag="{Binding Id}"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Margin="0,0,8,0" Height="32"/>
                                        <Button Click="DeletePool_Click" Tag="{Binding Id}"
                                                Style="{StaticResource MaterialDesignIconButton}"
                                                Height="32" Width="32" ToolTip="Delete Pool">
                                            <materialDesign:PackIcon Kind="Delete" Width="18" Height="18" Foreground="#F44336"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </materialDesign:Card>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Empty State -->
                <materialDesign:Card x:Name="EmptyPoolsState" Padding="40" HorizontalAlignment="Center" Visibility="Collapsed">
                    <StackPanel HorizontalAlignment="Center">
                        <materialDesign:PackIcon Kind="AccountGroupOutline" Width="64" Height="64"
                                                 Foreground="#B8B8D0" HorizontalAlignment="Center"/>
                        <TextBlock Text="ยังไม่มี Account Pool" FontSize="18" FontWeight="Bold"
                                   HorizontalAlignment="Center" Margin="0,15,0,5"/>
                        <TextBlock Text="สร้าง pool เพื่อจัดกลุ่ม accounts และเปิดใช้ rotation"
                                   Foreground="#B8B8D0" HorizontalAlignment="Center"/>
                        <Button Content="Create First Pool" Click="CreatePool_Click"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Margin="0,20,0,0"/>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>

            <!-- Health Monitor Panel -->
            <StackPanel x:Name="HealthMonitorPanel" Visibility="Collapsed">
                <!-- Summary Cards -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                    <materialDesign:Card Width="150" Padding="15" Margin="0,0,15,0">
                        <StackPanel>
                            <TextBlock Text="Total Accounts" FontSize="11" Foreground="#B8B8D0"/>
                            <TextBlock x:Name="TxtTotalAccounts" Text="0" FontSize="28" FontWeight="Bold"/>
                        </StackPanel>
                    </materialDesign:Card>
                    <materialDesign:Card Width="150" Padding="15" Margin="0,0,15,0">
                        <StackPanel>
                            <TextBlock Text="Active" FontSize="11" Foreground="#B8B8D0"/>
                            <TextBlock x:Name="TxtActiveAccounts" Text="0" FontSize="28" FontWeight="Bold" Foreground="#4CAF50"/>
                        </StackPanel>
                    </materialDesign:Card>
                    <materialDesign:Card Width="150" Padding="15" Margin="0,0,15,0">
                        <StackPanel>
                            <TextBlock Text="Cooldown" FontSize="11" Foreground="#B8B8D0"/>
                            <TextBlock x:Name="TxtCooldownAccounts" Text="0" FontSize="28" FontWeight="Bold" Foreground="#FF9800"/>
                        </StackPanel>
                    </materialDesign:Card>
                    <materialDesign:Card Width="150" Padding="15" Margin="0,0,15,0">
                        <StackPanel>
                            <TextBlock Text="Banned" FontSize="11" Foreground="#B8B8D0"/>
                            <TextBlock x:Name="TxtBannedAccounts" Text="0" FontSize="28" FontWeight="Bold" Foreground="#F44336"/>
                        </StackPanel>
                    </materialDesign:Card>
                    <materialDesign:Card Width="150" Padding="15">
                        <StackPanel>
                            <TextBlock Text="Success Rate" FontSize="11" Foreground="#B8B8D0"/>
                            <TextBlock x:Name="TxtSuccessRate" Text="0%" FontSize="28" FontWeight="Bold" Foreground="#2196F3"/>
                        </StackPanel>
                    </materialDesign:Card>
                </StackPanel>

                <!-- Alerts Section -->
                <TextBlock Text="Alerts" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                <ItemsControl x:Name="AlertsList" Margin="0,0,0,20">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="0,0,0,8" Padding="12" CornerRadius="8">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="#E3F2FD"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Severity}" Value="Warning">
                                                <Setter Property="Background" Value="#FFF3E0"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Severity}" Value="Critical">
                                                <Setter Property="Background" Value="#FFEBEE"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Width="20" Height="20" Margin="0,0,10,0" VerticalAlignment="Center">
                                        <materialDesign:PackIcon.Style>
                                            <Style TargetType="materialDesign:PackIcon">
                                                <Setter Property="Kind" Value="InformationOutline"/>
                                                <Setter Property="Foreground" Value="#1976D2"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Severity}" Value="Warning">
                                                        <Setter Property="Kind" Value="AlertOutline"/>
                                                        <Setter Property="Foreground" Value="#E65100"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Severity}" Value="Critical">
                                                        <Setter Property="Kind" Value="AlertCircleOutline"/>
                                                        <Setter Property="Foreground" Value="#C62828"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </materialDesign:PackIcon.Style>
                                    </materialDesign:PackIcon>
                                    <StackPanel>
                                        <TextBlock Text="{Binding AccountName}" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding Message}" Foreground="#B8B8D0" FontSize="12"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Health Report Table -->
                <TextBlock Text="Account Health" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                <DataGrid x:Name="HealthGrid" AutoGenerateColumns="False" IsReadOnly="True"
                          CanUserAddRows="False" CanUserDeleteRows="False"
                          HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                          Background="#1E1E2E" BorderThickness="1" BorderBrush="#3D3D5C">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Account" Binding="{Binding AccountName}" Width="150"/>
                        <DataGridTextColumn Header="Pool" Binding="{Binding PoolName}" Width="120"/>
                        <DataGridTextColumn Header="Platform" Binding="{Binding Platform}" Width="100"/>
                        <DataGridTemplateColumn Header="State" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border CornerRadius="4" Padding="6,2">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#E8F5E9"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding State}" Value="Cooldown">
                                                        <Setter Property="Background" Value="#FFF3E0"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding State}" Value="RateLimited">
                                                        <Setter Property="Background" Value="#FFF3E0"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding State}" Value="Banned">
                                                        <Setter Property="Background" Value="#FFEBEE"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding State}" Value="Disabled">
                                                        <Setter Property="Background" Value="#ECEFF1"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="{Binding State}" FontSize="11"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Success Rate" Binding="{Binding SuccessRateText}" Width="100"/>
                        <DataGridTextColumn Header="Daily Usage" Binding="{Binding DailyUsageText}" Width="100"/>
                        <DataGridTextColumn Header="Last Used" Binding="{Binding LastUsedText}" Width="120"/>
                        <DataGridTextColumn Header="Last Error" Binding="{Binding LastError}" Width="200"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>
