<Page x:Class="AIManager.UI.Views.Pages.GpuSetupWizardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
      Title="GPU Setup Wizard"
      Background="{DynamicResource MaterialDesign.Brush.Background}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="360" />
        </Grid.ColumnDefinitions>

        <!-- WebView Panel -->
        <Grid Grid.Column="0">
            <!-- WebView Browser -->
            <wv2:WebView2 x:Name="WebView"
                          Source="about:blank" />

            <!-- Loading Overlay -->
            <Border x:Name="LoadingOverlay"
                    Background="#80000000"
                    Visibility="Collapsed">
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                 IsIndeterminate="True"
                                 Width="48"
                                 Height="48"
                                 Foreground="White" />
                    <TextBlock Text="Loading..."
                               Foreground="White"
                               Margin="0,16,0,0"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Border>

            <!-- URL Bar -->
            <Border Background="{DynamicResource MaterialDesign.Brush.Card.Background}"
                    VerticalAlignment="Top"
                    Padding="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Back Button -->
                    <Button x:Name="BtnBack"
                            Grid.Column="0"
                            Style="{StaticResource MaterialDesignIconButton}"
                            Click="BtnBack_Click"
                            ToolTip="Back">
                        <materialDesign:PackIcon Kind="ArrowLeft" />
                    </Button>

                    <!-- Refresh Button -->
                    <Button x:Name="BtnRefresh"
                            Grid.Column="1"
                            Style="{StaticResource MaterialDesignIconButton}"
                            Click="BtnRefresh_Click"
                            ToolTip="Refresh">
                        <materialDesign:PackIcon Kind="Refresh" />
                    </Button>

                    <!-- URL TextBox -->
                    <TextBox x:Name="TxtUrl"
                             Grid.Column="2"
                             Margin="8,0"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             materialDesign:HintAssist.Hint="URL"
                             Padding="8,4"
                             KeyDown="TxtUrl_KeyDown" />

                    <!-- Navigate Button -->
                    <Button x:Name="BtnGo"
                            Grid.Column="3"
                            Style="{StaticResource MaterialDesignIconButton}"
                            Click="BtnGo_Click"
                            ToolTip="Go">
                        <materialDesign:PackIcon Kind="ArrowRight" />
                    </Button>
                </Grid>
            </Border>
        </Grid>

        <!-- AI Guide Panel -->
        <Border Grid.Column="1"
                Background="{DynamicResource MaterialDesign.Brush.Card.Background}"
                BorderBrush="{DynamicResource MaterialDesign.Brush.Separator}"
                BorderThickness="1,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0"
                        Background="{DynamicResource MaterialDesign.Brush.Primary}"
                        Padding="16">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="RobotExcited"
                                                     Width="24"
                                                     Height="24"
                                                     Foreground="White"
                                                     VerticalAlignment="Center" />
                            <TextBlock Text="AI Setup Guide"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       Margin="8,0,0,0"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock x:Name="TxtProviderName"
                                   Text="Select a GPU Provider to start"
                                   FontSize="12"
                                   Foreground="#B0FFFFFF"
                                   Margin="32,4,0,0" />
                    </StackPanel>
                </Border>

                <!-- Progress Steps -->
                <Border Grid.Row="1"
                        Background="{DynamicResource MaterialDesign.Brush.Background}"
                        Padding="16,12">
                    <ItemsControl x:Name="StepsProgress">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <Ellipse Width="20" Height="20"
                                             Fill="{Binding Background}"
                                             Stroke="{Binding BorderBrush}"
                                             StrokeThickness="2" />
                                    <TextBlock Text="{Binding StepNumber}"
                                               Foreground="White"
                                               FontSize="10"
                                               FontWeight="Bold"
                                               Margin="-14,0,0,0"
                                               VerticalAlignment="Center" />
                                    <TextBlock Text="{Binding Title}"
                                               Margin="8,0,0,0"
                                               Foreground="{Binding Foreground}"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>

                <!-- Guidance Messages -->
                <ScrollViewer Grid.Row="2"
                              VerticalScrollBarVisibility="Auto"
                              Padding="12">
                    <StackPanel x:Name="GuidanceMessages">
                        <!-- Welcome Message -->
                        <materialDesign:Card Padding="16" Margin="0,0,0,12">
                            <StackPanel>
                                <TextBlock Text="GPU Provider Selection"
                                           FontWeight="Bold"
                                           FontSize="14" />
                                <TextBlock Text="Select which GPU provider you want to set up:"
                                           Foreground="{DynamicResource MaterialDesign.Brush.Foreground.Light}"
                                           Margin="0,8,0,12"
                                           TextWrapping="Wrap" />

                                <!-- Provider Buttons -->
                                <ItemsControl x:Name="ProvidersList">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                                    Margin="0,4"
                                                    HorizontalContentAlignment="Left"
                                                    Click="ProviderButton_Click"
                                                    Tag="{Binding Type}">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="{Binding Icon}"
                                                                             Width="20"
                                                                             Height="20"
                                                                             VerticalAlignment="Center" />
                                                    <StackPanel Margin="12,0,0,0">
                                                        <TextBlock Text="{Binding Name}"
                                                                   FontWeight="SemiBold" />
                                                        <TextBlock Text="{Binding FreeQuota}"
                                                                   FontSize="11"
                                                                   Foreground="{DynamicResource MaterialDesign.Brush.Foreground.Light}" />
                                                    </StackPanel>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Auto Signup Card -->
                        <materialDesign:Card x:Name="AutoSignupCard"
                                             Padding="16"
                                             Margin="0,0,0,12"
                                             Background="{DynamicResource MaterialDesign.Brush.Primary.Light}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="RobotExcited"
                                                             Width="24"
                                                             Height="24"
                                                             Foreground="{DynamicResource MaterialDesign.Brush.Primary}" />
                                    <TextBlock Text="Auto Signup"
                                               FontWeight="Bold"
                                               FontSize="14"
                                               Margin="8,0,0,0"
                                               VerticalAlignment="Center" />
                                </StackPanel>

                                <TextBlock Text="Let AI automatically create accounts for you"
                                           FontSize="12"
                                           Opacity="0.8"
                                           Margin="32,4,0,8" />

                                <!-- Account Count -->
                                <Grid Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="Accounts to create:"
                                               VerticalAlignment="Center"
                                               FontSize="12" />
                                    <Slider x:Name="SliderAccountCount"
                                            Grid.Column="1"
                                            Minimum="1"
                                            Maximum="10"
                                            Value="3"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True"
                                            Margin="12,0" />
                                    <TextBlock x:Name="TxtAccountCount"
                                               Grid.Column="2"
                                               Text="3"
                                               FontWeight="Bold"
                                               Width="24"
                                               TextAlignment="Center"
                                               VerticalAlignment="Center" />
                                </Grid>

                                <!-- Email Options -->
                                <StackPanel Margin="0,12,0,0">
                                    <TextBlock Text="Email Source:"
                                               FontSize="12"
                                               Margin="0,0,0,4" />
                                    <RadioButton x:Name="RbTempEmail"
                                                 Content="Temporary Email (auto-verify)"
                                                 IsChecked="True"
                                                 FontSize="11" />
                                    <RadioButton x:Name="RbGmailPlus"
                                                 Content="Gmail+ (your email)"
                                                 FontSize="11"
                                                 Margin="0,4,0,0" />
                                    <TextBox x:Name="TxtBaseEmail"
                                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                             materialDesign:HintAssist.Hint="your.email@gmail.com"
                                             Visibility="Collapsed"
                                             Margin="20,4,0,0"
                                             FontSize="11"
                                             Padding="4" />
                                </StackPanel>

                                <!-- Progress -->
                                <StackPanel x:Name="AutoSignupProgress"
                                            Visibility="Collapsed"
                                            Margin="0,12,0,0">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock x:Name="TxtAutoSignupStatus"
                                                   Text="Signing up..."
                                                   FontSize="12" />
                                        <TextBlock x:Name="TxtAutoSignupCount"
                                                   Grid.Column="1"
                                                   Text="0/3"
                                                   FontWeight="Bold"
                                                   FontSize="12" />
                                    </Grid>
                                    <ProgressBar x:Name="ProgressAutoSignup"
                                                 Height="4"
                                                 Margin="0,8,0,0"
                                                 Value="0" />
                                </StackPanel>

                                <!-- Action Buttons -->
                                <Grid Margin="0,12,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <Button x:Name="BtnStartAutoSignup"
                                            Content="Start Auto Signup"
                                            Style="{StaticResource MaterialDesignRaisedButton}"
                                            Click="BtnStartAutoSignup_Click"
                                            Height="32">
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="RocketLaunch" />
                                                    <TextBlock Text="Start Auto Signup" Margin="8,0,0,0" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>

                                    <Button x:Name="BtnCancelAutoSignup"
                                            Grid.Column="1"
                                            Style="{StaticResource MaterialDesignFlatButton}"
                                            Content="Cancel"
                                            Click="BtnCancelAutoSignup_Click"
                                            Visibility="Collapsed"
                                            Margin="8,0,0,0"
                                            Height="32" />
                                </Grid>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Current Guidance Card -->
                        <materialDesign:Card x:Name="CurrentGuidanceCard"
                                             Padding="16"
                                             Margin="0,0,0,12"
                                             Visibility="Collapsed">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon x:Name="GuidanceIcon"
                                                             Kind="InformationOutline"
                                                             Width="20"
                                                             Height="20"
                                                             Foreground="{DynamicResource MaterialDesign.Brush.Primary}" />
                                    <TextBlock x:Name="GuidanceTitle"
                                               Text=""
                                               FontWeight="Bold"
                                               FontSize="14"
                                               Margin="8,0,0,0"
                                               VerticalAlignment="Center" />
                                </StackPanel>

                                <TextBlock x:Name="GuidanceMessage"
                                           Text=""
                                           TextWrapping="Wrap"
                                           Margin="28,8,0,0"
                                           Foreground="{DynamicResource MaterialDesign.Brush.Foreground.Light}" />

                                <!-- Tips -->
                                <ItemsControl x:Name="GuidanceTips"
                                              Margin="28,12,0,0">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}"
                                                       TextWrapping="Wrap"
                                                       Foreground="{DynamicResource MaterialDesign.Brush.Foreground.Light}"
                                                       Margin="0,4,0,0" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Chat History -->
                        <ItemsControl x:Name="ChatHistory">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <materialDesign:Card Padding="12"
                                                         Margin="0,0,0,8"
                                                         Background="{Binding Background}">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Title}"
                                                       FontWeight="SemiBold"
                                                       FontSize="13" />
                                            <TextBlock Text="{Binding Message}"
                                                       TextWrapping="Wrap"
                                                       Margin="0,4,0,0"
                                                       FontSize="12"
                                                       Foreground="{DynamicResource MaterialDesign.Brush.Foreground.Light}" />
                                        </StackPanel>
                                    </materialDesign:Card>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <!-- Workflow Recording Panel -->
                <Border Grid.Row="3"
                        Background="{DynamicResource MaterialDesign.Brush.Background}"
                        Padding="8,8,8,0"
                        BorderBrush="{DynamicResource MaterialDesign.Brush.Separator}"
                        BorderThickness="0,1,0,0">
                    <StackPanel>
                        <!-- Recording Controls -->
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Recording Status -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <Ellipse x:Name="RecordingIndicator"
                                         Width="10" Height="10"
                                         Fill="#EF4444"
                                         Visibility="Collapsed" />
                                <TextBlock x:Name="TxtRecordingStatus"
                                           Text="Not Recording"
                                           FontSize="12"
                                           Opacity="0.7"
                                           Margin="8,0,0,0"
                                           VerticalAlignment="Center" />
                                <TextBlock x:Name="TxtStepsCount"
                                           Text="(0 steps)"
                                           FontSize="11"
                                           Opacity="0.5"
                                           Margin="8,0,0,0"
                                           VerticalAlignment="Center" />
                            </StackPanel>

                            <!-- Recording Buttons -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <!-- Start Recording Button -->
                                <Button x:Name="BtnStartRecording"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Click="BtnStartRecording_Click"
                                        ToolTip="Start recording workflow"
                                        Margin="0,0,4,0"
                                        Height="32"
                                        Padding="8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Record" Foreground="#EF4444" />
                                        <TextBlock Text="Record" Margin="4,0,0,0" FontSize="12" />
                                    </StackPanel>
                                </Button>

                                <!-- Stop Recording Button -->
                                <Button x:Name="BtnStopRecording"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        Background="#EF4444"
                                        Click="BtnStopRecording_Click"
                                        ToolTip="Stop and save recording"
                                        Visibility="Collapsed"
                                        Height="32"
                                        Padding="8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Stop" />
                                        <TextBlock Text="Stop" Margin="4,0,0,0" FontSize="12" />
                                    </StackPanel>
                                </Button>

                                <!-- Replay Button -->
                                <Button x:Name="BtnReplay"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Click="BtnReplay_Click"
                                        ToolTip="Replay saved workflow"
                                        Margin="4,0,0,0"
                                        Height="32"
                                        Padding="8,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Play" Foreground="#10B981" />
                                        <TextBlock Text="Replay" Margin="4,0,0,0" FontSize="12" />
                                    </StackPanel>
                                </Button>

                                <!-- Manage Workflows Button -->
                                <Button x:Name="BtnManageWorkflows"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Click="BtnManageWorkflows_Click"
                                        ToolTip="Manage saved workflows"
                                        Height="32"
                                        Width="32">
                                    <materialDesign:PackIcon Kind="FolderOpen" Width="18" Height="18" />
                                </Button>
                            </StackPanel>
                        </Grid>

                        <!-- Action Buttons -->
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <!-- Analyze Button -->
                            <Button x:Name="BtnAnalyze"
                                    Grid.Column="0"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Click="BtnAnalyze_Click"
                                    HorizontalAlignment="Left"
                                    ToolTip="Analyze current page"
                                    Height="32">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="MagnifyScan" />
                                    <TextBlock Text="Analyze" Margin="8,0,0,0" />
                                </StackPanel>
                            </Button>

                            <!-- Skip Button -->
                            <Button x:Name="BtnSkip"
                                    Grid.Column="1"
                                    Style="{StaticResource MaterialDesignFlatButton}"
                                    Click="BtnSkip_Click"
                                    Margin="8,0"
                                    Visibility="Collapsed"
                                    Height="32">
                                <TextBlock Text="Skip" />
                            </Button>

                            <!-- Next Button -->
                            <Button x:Name="BtnNext"
                                    Grid.Column="2"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Click="BtnNext_Click"
                                    Visibility="Collapsed"
                                    Height="32">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Next" />
                                    <materialDesign:PackIcon Kind="ArrowRight" Margin="8,0,0,0" />
                                </StackPanel>
                            </Button>

                            <!-- Complete Button -->
                            <Button x:Name="BtnComplete"
                                    Grid.Column="2"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Background="Green"
                                    Click="BtnComplete_Click"
                                    Visibility="Collapsed"
                                    Height="32">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Check" />
                                    <TextBlock Text="Complete" Margin="8,0,0,0" />
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Page>
