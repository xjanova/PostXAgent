<Page x:Class="AIManager.UI.Views.Pages.ImageGeneratorPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      Title="Image / Video Generator">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Left Panel - Controls -->
        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="20">
                <!-- Connection Status -->
                <materialDesign:Card Padding="15" Margin="0,0,0,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Ellipse x:Name="ConnectionIndicator" Width="12" Height="12" Fill="#F44336"
                                 VerticalAlignment="Center"/>

                        <StackPanel Grid.Column="1" Margin="12,0,0,0">
                            <TextBlock x:Name="TxtConnectionStatus" Text="Disconnected" FontWeight="Bold"/>
                            <TextBlock x:Name="TxtConnectionUrl" Text="ComfyUI: --" FontSize="11" Foreground="#AAAAAA"/>
                        </StackPanel>

                        <Button Grid.Column="2" Click="RefreshConnection_Click"
                                Style="{StaticResource MaterialDesignIconButton}" ToolTip="Reconnect">
                            <materialDesign:PackIcon Kind="Refresh" Width="20" Height="20"/>
                        </Button>
                    </Grid>
                </materialDesign:Card>

                <!-- Mode Selection -->
                <materialDesign:Card Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Generation Mode" FontWeight="Bold" Margin="0,0,0,10"/>
                        <RadioButton x:Name="RbImage" Content="Image Generation" IsChecked="True"
                                     GroupName="Mode" Checked="Mode_Changed"/>
                        <RadioButton x:Name="RbVideo" Content="Video Generation" Margin="0,8,0,0"
                                     GroupName="Mode" Checked="Mode_Changed"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Provider Selection -->
                <materialDesign:Card Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Provider" FontWeight="Bold" Margin="0,0,0,10"/>
                        <ComboBox x:Name="CboProvider" SelectionChanged="Provider_Changed"
                                  Style="{StaticResource MaterialDesignOutlinedComboBox}">
                            <ComboBoxItem Content="ComfyUI" Tag="comfyui" IsSelected="True"/>
                            <ComboBoxItem Content="Custom Engine (Built-in)" Tag="custom"/>
                        </ComboBox>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Model Selection -->
                <materialDesign:Card Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Model" FontWeight="Bold" Margin="0,0,0,10"/>
                        <ComboBox x:Name="CboModel" Style="{StaticResource MaterialDesignOutlinedComboBox}"/>
                        <TextBlock x:Name="TxtModelInfo" Text="" FontSize="11" Foreground="#AAAAAA" Margin="0,5,0,0"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Prompt -->
                <materialDesign:Card Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Prompt" FontWeight="Bold" Margin="0,0,0,10"/>
                        <TextBox x:Name="TxtPrompt" AcceptsReturn="True" TextWrapping="Wrap"
                                 Height="100" VerticalScrollBarVisibility="Auto"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="Describe your image..."
                                 Text="A beautiful sunset over mountains, professional photography, 8k, highly detailed"/>

                        <TextBlock Text="Negative Prompt" FontWeight="Bold" Margin="0,15,0,10"/>
                        <TextBox x:Name="TxtNegativePrompt" AcceptsReturn="True" TextWrapping="Wrap"
                                 Height="60" VerticalScrollBarVisibility="Auto"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="What to avoid..."
                                 Text="blurry, bad quality, distorted, ugly"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Image Settings -->
                <materialDesign:Card x:Name="ImageSettings" Padding="15" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Image Settings" FontWeight="Bold" Margin="0,0,0,10"/>

                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                <TextBlock Text="Width" FontSize="12"/>
                                <ComboBox x:Name="CboWidth" Style="{StaticResource MaterialDesignOutlinedComboBox}">
                                    <ComboBoxItem Content="512" Tag="512"/>
                                    <ComboBoxItem Content="768" Tag="768"/>
                                    <ComboBoxItem Content="1024" Tag="1024" IsSelected="True"/>
                                    <ComboBoxItem Content="1280" Tag="1280"/>
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                <TextBlock Text="Height" FontSize="12"/>
                                <ComboBox x:Name="CboHeight" Style="{StaticResource MaterialDesignOutlinedComboBox}">
                                    <ComboBoxItem Content="512" Tag="512"/>
                                    <ComboBoxItem Content="768" Tag="768"/>
                                    <ComboBoxItem Content="1024" Tag="1024" IsSelected="True"/>
                                    <ComboBoxItem Content="1280" Tag="1280"/>
                                </ComboBox>
                            </StackPanel>
                        </Grid>

                        <StackPanel Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Steps: " FontSize="12"/>
                                <TextBlock x:Name="TxtStepsValue" Text="20" FontSize="12" FontWeight="Bold"/>
                            </StackPanel>
                            <Slider x:Name="SliderSteps" Minimum="10" Maximum="50" Value="20"
                                    TickFrequency="5" IsSnapToTickEnabled="True"
                                    ValueChanged="Slider_ValueChanged"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="CFG Scale: " FontSize="12"/>
                                <TextBlock x:Name="TxtCfgValue" Text="7.0" FontSize="12" FontWeight="Bold"/>
                            </StackPanel>
                            <Slider x:Name="SliderCfg" Minimum="1" Maximum="20" Value="7"
                                    TickFrequency="0.5" IsSnapToTickEnabled="True"
                                    ValueChanged="Slider_ValueChanged"/>
                        </StackPanel>

                        <StackPanel>
                            <TextBlock Text="Seed (-1 = random)" FontSize="12"/>
                            <TextBox x:Name="TxtSeed" Text="-1"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Video Settings -->
                <materialDesign:Card x:Name="VideoSettings" Padding="15" Margin="0,0,0,15" Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="Video Settings" FontWeight="Bold" Margin="0,0,0,10"/>

                        <StackPanel Margin="0,0,0,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Frames: " FontSize="12"/>
                                <TextBlock x:Name="TxtFramesValue" Text="16" FontSize="12" FontWeight="Bold"/>
                            </StackPanel>
                            <Slider x:Name="SliderFrames" Minimum="8" Maximum="32" Value="16"
                                    TickFrequency="8" IsSnapToTickEnabled="True"
                                    ValueChanged="Slider_ValueChanged"/>
                        </StackPanel>

                        <StackPanel>
                            <TextBlock Text="FPS" FontSize="12"/>
                            <ComboBox x:Name="CboFps" Style="{StaticResource MaterialDesignOutlinedComboBox}">
                                <ComboBoxItem Content="8" Tag="8" IsSelected="True"/>
                                <ComboBoxItem Content="12" Tag="12"/>
                                <ComboBoxItem Content="24" Tag="24"/>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Generate Button -->
                <Button x:Name="BtnGenerate" Content="Generate" Click="Generate_Click"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#2196F3" Foreground="White" Height="45" FontSize="16"/>

                <Button x:Name="BtnCancel" Content="Cancel" Click="Cancel_Click" Visibility="Collapsed"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#F44336" Foreground="White" Height="45" FontSize="16" Margin="0,10,0,0"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Right Panel - Preview -->
        <Grid Grid.Column="1" Margin="0,20,20,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                <TextBlock Text="Preview" FontSize="18" FontWeight="Bold"/>
                <Button x:Name="BtnSave" Content="Save" Click="Save_Click" Margin="15,0,0,0"
                        Style="{StaticResource MaterialDesignOutlinedButton}" Visibility="Collapsed"/>
                <Button x:Name="BtnOpenFolder" Content="Open Folder" Click="OpenFolder_Click" Margin="5,0,0,0"
                        Style="{StaticResource MaterialDesignOutlinedButton}" Visibility="Collapsed"/>
            </StackPanel>

            <!-- Preview Area -->
            <Border Grid.Row="1" Background="#1E1E2E" CornerRadius="8">
                <Grid>
                    <!-- Placeholder -->
                    <StackPanel x:Name="PlaceholderPanel" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <materialDesign:PackIcon Kind="ImageArea" Width="100" Height="100"
                                                 HorizontalAlignment="Center" Foreground="#5D5D7A"/>
                        <TextBlock Text="Generated image will appear here" FontSize="14"
                                   Foreground="#9090A8" HorizontalAlignment="Center" Margin="0,15,0,0"/>
                    </StackPanel>

                    <!-- Generated Image -->
                    <Image x:Name="PreviewImage" Stretch="Uniform" Margin="20" Visibility="Collapsed"/>

                    <!-- Generated Video -->
                    <MediaElement x:Name="PreviewVideo" LoadedBehavior="Manual" UnloadedBehavior="Stop"
                                  Stretch="Uniform" Margin="20" Visibility="Collapsed"/>

                    <!-- Progress Overlay -->
                    <Border x:Name="ProgressOverlay" Background="#E01E1E2E" Visibility="Collapsed">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <ProgressBar x:Name="GenerationProgress" IsIndeterminate="True"
                                         Style="{StaticResource MaterialDesignCircularProgressBar}"
                                         Width="60" Height="60"/>
                            <TextBlock x:Name="TxtProgressStatus" Text="Generating..." FontSize="14" Foreground="White"
                                       HorizontalAlignment="Center" Margin="0,15,0,0"/>
                            <TextBlock x:Name="TxtProgressDetail" Text="" FontSize="12" Foreground="#B8B8D0"
                                       HorizontalAlignment="Center" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- History (Optional) -->
            <materialDesign:Card Grid.Row="2" Margin="0,15,0,0" Padding="15" x:Name="HistoryPanel">
                <StackPanel>
                    <TextBlock Text="Recent Generations" FontWeight="Bold" Margin="0,0,0,10"/>
                    <ListBox x:Name="HistoryList" Height="80" SelectionChanged="History_SelectionChanged">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Width="60" Height="60" CornerRadius="4" ClipToBounds="True"
                                        Margin="0,0,5,0" Cursor="Hand">
                                    <Image Source="{Binding Thumbnail}" Stretch="UniformToFill"/>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
            </materialDesign:Card>
        </Grid>
    </Grid>
</Page>
